<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="swipe-voting-card.html">

<!--
@demo demo/index.html
-->

<dom-module id="swipe-voting">
  <template>
    <style>
      :host {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

      #defaultCard {
        background: #eee;
        display: none;
      }
    </style>

    <content></content>

    <paper-card id="defaultCard">
      <div id="swipe-overlay" on-track="handleTrack"></div>
      <div class="card-content"><h1>{{defaultMessage}}</h1></div>
    </paper-card>

  </template>

  <script>
    Polymer({
      is: 'swipe-voting',

      listeners: {
        'reject': 'handleRejection',
        'accept': 'handleAcception'
      },

      properties: {
        active: {
          type: Number,
          notify: true,
          value: 0
        },

        defaultMessage: {
          type: String,
          notify: true,
          value: "You have reached the end."
        }, 

        onrejection: {
          type: Object,
          notify: true,
          value: function() {return 0;}
        },

        onacception: {
          type: Object,
          notify: true,
          value: function() {return 0;}
        }
      },

      refresh: function () {
        for (i = 0; i < this.children.length; i++) {
          this.children[i].index = i;
          if(i == this.active)
            this.children[i].style.display = "block";
          else
            this.children[i].style.display = "none";
        }
      },

      handleRejection: function (event) {
        this.onrejection(event.detail.index, this.children[event.detail.index].cardTitle);
        if(event.detail.index < this.queryAllEffectiveChildren('swipe-voting-card').length-1)
          this.children[event.detail.index+1].style.display = "block";
        else 
          this.$$('#defaultCard').style.display = "block"
      },

      handleAcception: function (event) {
        this.onacception(event.detail.index, this.children[event.detail.index].cardTitle);
        this.fire('swipe-card', {
          "id": event.detail.index,
          "title": this.children[event.detail.index].cardTitle,
          "state": 'accepted'
        });
        if(event.detail.index < this.queryAllEffectiveChildren('swipe-voting-card').length-1)
          this.children[event.detail.index+1].style.display = "block";
        else 
          this.$$('#defaultCard').style.display = "block"
      }

    });
  </script>
</dom-module>
